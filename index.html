<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>二十届四中全会知识答题</title>
    <script src="config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 800px;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header h2 {
            font-size: 1.3em;
            font-weight: 300;
            opacity: 0.9;
        }

        .screen {
            padding: 40px;
            display: none;
        }

        .active {
            display: block;
        }

        /* 欢迎页面样式 */
        .welcome-content {
            text-align: center;
        }

        .welcome-content h3 {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        .welcome-content p {
            color: #7f8c8d;
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        /* 信息输入页面样式 */
        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: bold;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #3498db;
        }

        /* 答题页面样式 */
        .question-container {
            margin-bottom: 30px;
        }

        .question-number {
            color: #3498db;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .options {
            display: grid;
            gap: 12px;
        }

        .option {
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .option:hover {
            border-color: #3498db;
            background: #e3f2fd;
        }

        .option.selected {
            border-color: #3498db;
            background: #3498db;
            color: white;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        /* 结果页面样式 */
        .result-content {
            text-align: center;
        }

        .score-display {
            font-size: 4em;
            color: #3498db;
            margin: 20px 0;
            font-weight: bold;
        }

        .score-text {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .detailed-results {
            text-align: left;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .result-item {
            padding: 10px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .correct {
            color: #27ae60;
        }

        .wrong {
            color: #e74c3c;
        }

        /* 排行榜样式 */
        .scoreboard-content h3 {
            color: #2c3e50;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.8em;
        }

        .score-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .score-item {
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .score-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .score-name {
            font-weight: bold;
            color: #2c3e50;
        }

        .score-percentage {
            color: #3498db;
            font-weight: bold;
        }

        .score-details {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .loading {
            text-align: center;
            color: #7f8c8d;
            padding: 20px;
        }

        .error {
            text-align: center;
            color: #e74c3c;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .screen {
                padding: 25px;
            }
            
            .btn {
                padding: 12px 30px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>二十届四中全会知识答题</h1>
            <h2>深入学习领会全会精神 把握"十五五"规划方向 - 成绩共享版</h2>
        </div>

        <!-- 欢迎页面 -->
        <div id="welcome-screen" class="screen active">
            <div class="welcome-content">
                <h3>欢迎参加知识答题</h3>
                <p>本次答题包含10道关于二十届四中全会精神的题目，旨在帮助您深入理解全会内容和"十五五"规划方向。</p>
                <p>完成后可将成绩分享到排行榜，与同事朋友一起学习进步！</p>
                <button class="btn" onclick="showScreen('info-screen')">开始答题</button>
                <button class="btn btn-secondary" onclick="showScreen('scoreboard-screen')">查看成绩排行榜</button>
            </div>
        </div>

        <!-- 信息输入页面 -->
        <div id="info-screen" class="screen">
            <div class="input-group">
                <label for="name">姓名</label>
                <input type="text" id="name" placeholder="请输入您的姓名">
            </div>
            <div class="input-group">
                <label for="organization">单位/部门</label>
                <input type="text" id="organization" placeholder="请输入您的单位或部门">
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="startQuiz()">开始答题</button>
                <button class="btn btn-secondary" onclick="showScreen('welcome-screen')">返回</button>
            </div>
        </div>

        <!-- 答题页面 -->
        <div id="quiz-screen" class="screen">
            <div class="question-container">
                <div class="question-number" id="question-number">题目 1/10</div>
                <div class="question-text" id="question-text"></div>
                <div class="options" id="options-container"></div>
            </div>
            <div class="navigation">
                <button class="btn btn-secondary" id="prev-btn" onclick="previousQuestion()">上一题</button>
                <button class="btn" id="next-btn" onclick="nextQuestion()">下一题</button>
                <button class="btn" id="submit-btn" onclick="submitQuiz()" style="display: none;">提交答案</button>
            </div>
        </div>

        <!-- 结果页面 -->
        <div id="result-screen" class="screen">
            <div class="result-content">
                <h3>答题完成!</h3>
                <div class="score-display" id="final-score">0/10</div>
                <div class="score-text" id="score-text"></div>
                
                <div class="detailed-results" id="detailed-results"></div>
                
                <button class="btn" onclick="submitScoreToGitHub()">提交成绩到GitHub</button>
                <button class="btn btn-secondary" onclick="showScreen('scoreboard-screen')">查看成绩排行榜</button>
                <button class="btn btn-secondary" onclick="restartQuiz()">重新答题</button>
            </div>
        </div>

        <!-- 排行榜页面 -->
        <div id="scoreboard-screen" class="screen">
            <div class="scoreboard-content">
                <h3>成绩排行榜</h3>
                <div id="scoreboard-list">
                    <div class="loading">正在加载成绩数据...</div>
                </div>
                <div style="text-align: center; margin-top: 25px;">
                    <button class="btn btn-secondary" onclick="showScreen('welcome-screen')">返回首页</button>
                    <button class="btn" onclick="refreshScoreboard()">刷新排行榜</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 答题数据
        const questions = [
            {
                question: "二十届四中全会的主要议程是什么？",
                options: [
                    "A. 审议通过《中共中央关于进一步全面深化改革、推进中国式现代化的决定》",
                    "B. 讨论经济工作安排",
                    "C. 研究部署反腐败工作",
                    "D. 制定年度工作计划"
                ],
                correct: 0
            },
            {
                question: "四中全会强调要健全什么样的制度体系？",
                options: [
                    "A. 党的领导制度体系",
                    "B. 市场经济制度体系",
                    "C. 社会治理制度体系",
                    "D. 文化发展制度体系"
                ],
                correct: 0
            },
            {
                question: "全会指出，中国式现代化的核心要义包括什么？",
                options: [
                    "A. 人口规模巨大的现代化",
                    "B. 全体人民共同富裕的现代化",
                    "C. 物质文明和精神文明相协调的现代化",
                    "D. 以上都是"
                ],
                correct: 3
            },
            {
                question: "四中全会对'十五五'规划的主要要求是什么？",
                options: [
                    "A. 坚持高质量发展为主题",
                    "B. 以科技创新引领现代化产业体系建设",
                    "C. 统筹发展和安全",
                    "D. 以上都是"
                ],
                correct: 3
            },
            {
                question: "全会强调要完善什么样的监督体系？",
                options: [
                    "A. 党内监督为主导的各类监督贯通协调机制",
                    "B. 金融监管体系",
                    "C. 市场监督体系",
                    "D. 社会监督体系"
                ],
                correct: 0
            },
            {
                question: "四中全会提出要健全什么样的社会治理体系？",
                options: [
                    "A. 共建共治共享的社会治理体系",
                    "B. 政府主导的社会治理体系",
                    "C. 市场化的社会治理体系",
                    "D. 传统的社会治理体系"
                ],
                correct: 0
            },
            {
                question: "全会强调要坚持和发展什么样的基本经济制度？",
                options: [
                    "A. 公有制为主体、多种所有制经济共同发展",
                    "B. 完全的市场经济制度",
                    "C. 计划经济制度",
                    "D. 混合所有制经济制度"
                ],
                correct: 0
            },
            {
                question: "四中全会对生态文明建设提出了什么要求？",
                options: [
                    "A. 协同推进降碳、减污、扩绿、增长",
                    "B. 优先发展经济后治理环境",
                    "C. 暂停工业发展保护环境",
                    "D. 完全依靠市场调节"
                ],
                correct: 0
            },
            {
                question: "全会指出要完善什么样的国家安全体系？",
                options: [
                    "A. 集中统一、高效权威的国家安全体系",
                    "B. 分散管理的安全体系",
                    "C. 以市场为主导的安全体系",
                    "D. 传统安全体系"
                ],
                correct: 0
            },
            {
                question: "四中全会强调要加强哪方面的建设？",
                options: [
                    "A. 党的执政能力和领导水平建设",
                    "B. 基础设施建设",
                    "C. 商业设施建设",
                    "D. 娱乐设施建设"
                ],
                correct: 0
            }
        ];

        // 全局变量
        let currentQuestion = 0;
        let userAnswers = new Array(questions.length).fill(null);
        let score = 0;
        let userInfo = { name: '', organization: '' };

        // 显示指定屏幕
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            
            if (screenId === 'scoreboard-screen') {
                loadScoreboard();
            }
        }

        // 开始答题
        function startQuiz() {
            const name = document.getElementById('name').value.trim();
            const organization = document.getElementById('organization').value.trim();
            
            if (!name) {
                alert('请输入您的姓名');
                return;
            }
            
            userInfo = { name, organization };
            currentQuestion = 0;
            userAnswers.fill(null);
            score = 0;
            
            showScreen('quiz-screen');
            loadQuestion();
        }

        // 加载题目
        function loadQuestion() {
            const question = questions[currentQuestion];
            document.getElementById('question-number').textContent = `题目 ${currentQuestion + 1}/${questions.length}`;
            document.getElementById('question-text').textContent = question.question;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = `option ${userAnswers[currentQuestion] === index ? 'selected' : ''}`;
                optionElement.textContent = option;
                optionElement.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionElement);
            });
            
            // 更新导航按钮
            document.getElementById('prev-btn').style.display = currentQuestion === 0 ? 'none' : 'block';
            document.getElementById('next-btn').style.display = currentQuestion === questions.length - 1 ? 'none' : 'block';
            document.getElementById('submit-btn').style.display = currentQuestion === questions.length - 1 ? 'block' : 'none';
        }

        // 选择选项
        function selectOption(optionIndex) {
            userAnswers[currentQuestion] = optionIndex;
            loadQuestion();
        }

        // 下一题
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                loadQuestion();
            }
        }

        // 上一题
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
            }
        }

        // 提交答题
        function submitQuiz() {
            calculateScore();
            showResults();
            showScreen('result-screen');
        }

        // 计算分数
        function calculateScore() {
            score = 0;
            questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) {
                    score++;
                }
            });
        }

        // 显示结果
        function showResults() {
            document.getElementById('final-score').textContent = `${score}/${questions.length}`;
            
            const percentage = calculatePercentage();
            let scoreText = '';
            if (percentage >= 90) scoreText = '优秀！您对全会精神理解深刻';
            else if (percentage >= 70) scoreText = '良好！您对全会内容掌握较好';
            else if (percentage >= 60) scoreText = '及格！建议进一步学习全会精神';
            else scoreText = '需要加强学习，建议重新学习全会内容';
            
            document.getElementById('score-text').textContent = `正确率: ${percentage}% - ${scoreText}`;
            
            // 显示详细结果
            const detailedResults = document.getElementById('detailed-results');
            detailedResults.innerHTML = '<h4>答题详情:</h4>';
            
            questions.forEach((question, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                
                const isCorrect = userAnswers[index] === question.correct;
                const answerText = userAnswers[index] !== null ? 
                    question.options[userAnswers[index]] : '未作答';
                const correctAnswer = question.options[question.correct];
                
                resultItem.innerHTML = `
                    <div><strong>第${index + 1}题:</strong> ${question.question}</div>
                    <div class="${isCorrect ? 'correct' : 'wrong'}">
                        您的答案: ${answerText} ${isCorrect ? '✓' : '✗'}
                    </div>
                    ${!isCorrect ? `<div class="correct">正确答案: ${correctAnswer}</div>` : ''}
                `;
                
                detailedResults.appendChild(resultItem);
            });
        }

        // 计算正确率
        function calculatePercentage() {
            return Math.round((score / questions.length) * 100);
        }

        // 重新开始
        function restartQuiz() {
            showScreen('welcome-screen');
        }

        // 提交成绩到GitHub
        async function submitScoreToGitHub() {
            try {
                // 检查CONFIG对象是否已加载
                if (typeof CONFIG === 'undefined') {
                    throw new Error('系统配置未加载，请稍后重试');
                }

                const response = await fetch(`https://api.github.com/repos/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/issues`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${CONFIG.GITHUB_TOKEN}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: `成绩记录 - ${userInfo.name} - ${calculatePercentage()}%`,
                        body: `姓名：${userInfo.name}\n单位：${userInfo.organization}\n正确数：${score}\n总题数：${questions.length}\n正确率：${calculatePercentage()}%`,
                        labels: [CONFIG.LABEL]
                    })
                });
                
                if (response.ok) {
                    alert('成绩已成功提交到GitHub！');
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || '提交失败');
                }
            } catch (error) {
                console.error('提交到GitHub失败:', error);
                alert('提交到GitHub失败，已保存到本地存储');
                saveToLocalStorage();
            }
        }

        // 保存到本地存储
        function saveToLocalStorage() {
            const localScores = JSON.parse(localStorage.getItem('quizScores') || '[]');
            localScores.push({
                name: userInfo.name,
                organization: userInfo.organization,
                score: score,
                total: questions.length,
                percentage: calculatePercentage(),
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('quizScores', JSON.stringify(localScores));
        }

        // 加载成绩排行榜
        async function loadScoreboard() {
            const scoreboardList = document.getElementById('scoreboard-list');
            scoreboardList.innerHTML = '<div class="loading">正在加载成绩数据...</div>';
            
            try {
                // 检查CONFIG对象是否已加载
                if (typeof CONFIG === 'undefined') {
                    throw new Error('系统配置未加载');
                }

                const response = await fetch(`https://api.github.com/repos/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/issues?labels=${CONFIG.LABEL}`, {
                    headers: {
                        'Authorization': `token ${CONFIG.GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const issues = await response.json();
                    displayScoreboard(issues);
                } else {
                    throw new Error('获取GitHub数据失败');
                }
            } catch (error) {
                console.error('获取排行榜失败:', error);
                loadFromLocalStorage();
            }
        }

        // 显示排行榜
        function displayScoreboard(issues) {
            const scoreboardList = document.getElementById('scoreboard-list');
            
            if (!issues || issues.length === 0) {
                scoreboardList.innerHTML = '<div class="error">暂无成绩记录</div>';
                return;
            }
            
            // 从issues中提取成绩信息
            const scores = issues.map(issue => {
                const titleMatch = issue.title.match(/成绩记录 - (.+?) - (\d+)%/);
                const body = issue.body || '';
                
                if (titleMatch) {
                    return {
                        name: titleMatch[1],
                        percentage: parseInt(titleMatch[2]),
                        details: body,
                        timestamp: issue.created_at
                    };
                }
                return null;
            }).filter(score => score !== null);
            
            // 按正确率排序
            scores.sort((a, b) => b.percentage - a.percentage);
            
            if (scores.length === 0) {
                scoreboardList.innerHTML = '<div class="error">暂无有效成绩记录</div>';
                return;
            }
            
            scoreboardList.innerHTML = '';
            scores.forEach((score, index) => {
                const scoreItem = document.createElement('div');
                scoreItem.className = 'score-item';
                scoreItem.innerHTML = `
                    <div class="score-header">
                        <span class="score-name">${index + 1}. ${score.name}</span>
                        <span class="score-percentage">${score.percentage}%</span>
                    </div>
                    <div class="score-details">${score.details.split('\n')[0]}</div>
                `;
                scoreboardList.appendChild(scoreItem);
            });
        }

        // 从本地存储加载
        function loadFromLocalStorage() {
            const scoreboardList = document.getElementById('scoreboard-list');
            const localScores = JSON.parse(localStorage.getItem('quizScores') || '[]');
            
            if (localScores.length === 0) {
                scoreboardList.innerHTML = '<div class="error">暂无成绩记录</div>';
                return;
            }
            
            localScores.sort((a, b) => b.percentage - a.percentage);
            scoreboardList.innerHTML = '';
            
            localScores.forEach((score, index) => {
                const scoreItem = document.createElement('div');
                scoreItem.className = 'score-item';
                scoreItem.innerHTML = `
                    <div class="score-header">
                        <span class="score-name">${index + 1}. ${score.name}</span>
                        <span class="score-percentage">${score.percentage}%</span>
                    </div>
                    <div class="score-details">${score.organization} - 正确: ${score.score}/${score.total}</div>
                `;
                scoreboardList.appendChild(scoreItem);
            });
        }

        // 刷新排行榜
        function refreshScoreboard() {
            loadScoreboard();
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('答题系统初始化完成');
        });
    </script>
</body>
</html>
